"use strict";var express=require("express"),router=express.Router(),Employee=require("../models/employee"),Participation=require("../models/participation"),Customer=require("../models/customer"),Project=require("../models/project"),catchErrors=require("../lib/async-error");router.get("/",function(e,r,t){r.render("management/index",{})}),router.get("/customer/register",catchErrors(function(e,r){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:r.render("management/registerCustomer",{});case 1:case"end":return e.stop()}})})),router.get("/customer/list",catchErrors(function(e,r){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(Customer.findAll());case 2:t=e.sent,r.render("management/customerList",{customers:t});case 4:case"end":return e.stop()}})})),router.post("/customer/register",catchErrors(function(r,t){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(Customer.create({customer_name:r.body.name}));case 2:e.sent,r.flash("success","정상적으로 등록되었습니다."),t.redirect("/");case 5:case"end":return e.stop()}})})),router.get("/project/register",catchErrors(function(e,r){var t,n,s,a,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(Customer.findAll());case 2:return t=e.sent,e.next=5,regeneratorRuntime.awrap(Employee.findAll({where:{dept_no:1}}));case 5:return n=e.sent,e.next=8,regeneratorRuntime.awrap(Employee.findAll({where:{dept_no:2}}));case 8:return s=e.sent,e.next=11,regeneratorRuntime.awrap(Employee.findAll({where:{dept_no:3}}));case 11:return a=e.sent,e.next=14,regeneratorRuntime.awrap(Employee.findAll({where:{dept_no:4}}));case 14:o=e.sent,r.render("management/registerProject",{customers:t,marketing:n,research:s,business:a,development:o});case 16:case"end":return e.stop()}})})),router.get("/project/search",catchErrors(function(e,r){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:r.render("management/searchProject",{});case 1:case"end":return e.stop()}})})),router.post("/project/register",catchErrors(function(r,t){var n,s,a,o,c,u,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(r.body),e.next=3,regeneratorRuntime.awrap(Project.create({project_name:r.body.name,start_date:r.body.start,end_date:r.body.end,state:r.body.state,description:r.body.description,customer_id:r.body.customer}));case 3:n=e.sent,a=!(s=!0),o=void 0,e.prev=7,c=r.body.employee[Symbol.iterator]();case 9:if(s=(u=c.next()).done){e.next=16;break}return i=u.value,e.next=13,regeneratorRuntime.awrap(Participation.create({emp_no:i,project_no:n.project_no,participation_date:n.start_date}));case 13:s=!0,e.next=9;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(7),a=!0,o=e.t0;case 22:e.prev=22,e.prev=23,s||null==c.return||c.return();case 25:if(e.prev=25,a)throw o;e.next=28;break;case 28:return e.finish(25);case 29:return e.finish(22);case 30:r.flash("success","정상적으로 등록되었습니다."),t.render("project/list",{});case 32:case"end":return e.stop()}},null,null,[[7,18,22,30],[23,,25,29]])})),module.exports=router;
//# sourceMappingURL=management.min.js.map
